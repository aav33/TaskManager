<<<<<<< Updated upstream
<<<<<<< Updated upstream
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Boards â€” TaulunÃ¤kymÃ¤ (Demo)</title>
<style>
:root {
    --bg: #f6f8fb;
    --card: #ffffff;
    --accent: #6c63ff;
    --muted: #6b7280;
}
* { box-sizing: border-box; }
body {
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    padding: 24px;
}
.card {
    width: 100%;
    max-width: 1200px;
    background: var(--card);
    border-radius: 14px;
    box-shadow: 0 8px 30px rgba(21, 24, 40, 0.08);
    display: grid;
    grid-template-columns: 280px 1fr;
    overflow: hidden;
}
.sidebar {
    padding: 20px;
    border-right: 1px solid #f0f2fb;
}
.logo { font-weight: 800; color: var(--accent); font-size: 18px; margin-bottom: 10px; }
.boards-list { margin-top: 12px; display:flex; flex-direction:column; gap:8px }
.board-item { padding:10px; border-radius:8px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; border:1px solid transparent }
.board-item.active { background: rgba(108,99,255,0.08); border-color: rgba(108,99,255,0.12); }
.small { font-size:13px; color:var(--muted) }
.forms { padding: 20px; background: #fbfbff; display:flex; gap:8px; align-items:center }
.forms input[type="text"] { flex:1; padding:8px 10px; border-radius:8px; border:1px solid #e6e9f2 }
.btn { background: var(--accent); color: white; padding: 8px 10px; border-radius: 8px; border: 0; cursor: pointer; font-weight: 700 }
.btn.ghost { background: transparent; color: var(--accent); border: 1px solid rgba(108, 99, 255, 0.12); }
.main { padding: 18px; }
.board-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px }
.board-title { font-size:20px; margin:0 }
.controls { display:flex; gap:8px }
.columns { display:flex; gap:12px; align-items:flex-start; overflow:auto; padding-bottom:12px }
.column { width: 300px; background:#fbfbff; border-radius:12px; padding:12px; box-shadow: 0 6px 18px rgba(17,20,40,0.04) }
.column h3 { margin:0 0 8px 0; font-size:16px }
.task { background:white; padding:8px 10px; border-radius:8px; margin-bottom:8px; display:flex; align-items:center; gap:8px; border:1px solid #f0f2fb }
.task.done { opacity:0.6; text-decoration:line-through }
.task .title { flex:1 }
.color-dot { width:12px; height:12px; border-radius:50%; display:inline-block; margin-right:6px }
.placeholder { color:var(--muted); font-size:14px }
.footer-note { font-size:12px; color:var(--muted); margin-top:10px }
.input-row { display:flex; gap:8px; margin-bottom:10px }
.input-row input[type='text']{ flex:1; padding:8px; border-radius:8px; border:1px solid #e6e9f2 }
.copy { cursor:pointer; padding:6px 8px; border-radius:8px; border:1px dashed rgba(108,99,255,0.2) }
@media (max-width: 880px) {
    .card { grid-template-columns: 1fr; max-width: 680px }
    .columns { overflow-x: scroll }
}
</style>
</head>
<body>
<div class="card">
  <div class="sidebar">
    <div class="logo">Mini Boards</div>
    <div class="small">Boards</div>
    <div class="boards-list" id="boardsList"></div>

    <div class="forms" style="margin-top:12px">
      <input type="text" id="newBoardTitle" placeholder="Uusi taulu" />
      <button class="btn" id="createBoardBtn">Luo</button>
    </div>

    <div style="margin-top:12px">
      <div class="small">Liity tauluun koodilla</div>
      <div style="display:flex;gap:8px;margin-top:6px">
        <input id="joinCodeInput" placeholder="000123" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e9f2" />
        <button class="btn ghost" id="joinCodeBtn">Liity</button>
      </div>
      <div id="joinMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div class="footer-note">TÃ¤mÃ¤ demo kÃ¤yttÃ¤Ã¤ LocalStoragea. EÄŸer backend hazÄ±rsa, `appConfig.backendAvailable=true` ile gerÃ§ek API Ã§aÄŸrÄ±larÄ± yapÄ±lÄ±r.</div>
  </div>

  <div class="main">
    <div class="board-header">
      <div>
        <h2 class="board-title" id="boardTitle">Valitse taulu</h2>
        <div class="small" id="boardMeta"></div>
      </div>
      <div class="controls">
        <button class="btn ghost" id="shareBtn">Jaa</button>
        <div id="shareCodeBox" style="display:none;align-items:center;gap:8px">
          <span class="small" id="shareCodeText"></span>
          <button class="btn" id="copyShareBtn">Kopioi</button>
        </div>
      </div>
    </div>

    <div class="columns" id="columns"></div>

    <div style="margin-top:12px">
      <div class="small">Esimerkkiverkko: tehtÃ¤vÃ¤t, minitaulut ja jako.</div>
    </div>
  </div>
</div>

<script>
/*
  Mini Boards â€” single-file front-end demo.
  - LocalStorage based data model compatible with the DB model discussed earlier.
  - Supports: create board, create category, create task, mark done, delete, share-code generation (local) and join-by-code (local).
  - If you have backend endpoints, set appConfig.backendAvailable = true and fill api endpoints.
*/

const appConfig = {
  backendAvailable: false, // set true if you have working backend URLs
  api: {
    activateShare: '/api/activate_share.php',
    joinWithCode: '/api/join_with_code.php'
  }
};

// --- data helpers (localStorage) ---
function loadData() {
  const raw = localStorage.getItem('mini_boards_v1');
  return raw ? JSON.parse(raw) : { users:[], boards:[], categories:[], tasks:[] };
}
function saveData(data) { localStorage.setItem('mini_boards_v1', JSON.stringify(data)); }

function uid() { return Math.floor(Date.now() + Math.random()*1000); }

// initial demo data
let store = loadData();
if (!store._initialized) {
  // create a demo user
  const me = { id: 1, email: 'demo@example.com', display_name: 'Demo' };
  store.users.push(me);
  // demo board
  const bid = uid();
  store.boards.push({ id: bid, owner_id: me.id, title: 'Esimerkkitaulu', visibility: 'private', share_code: null, share_code_expires: null, created_at: new Date().toISOString() });
  const c1 = uid(); const c2 = uid();
  store.categories.push({ id: c1, board_id: bid, name: 'Koulu', color: '#6c63ff' });
  store.categories.push({ id: c2, board_id: bid, name: 'Koti', color: '#ff9f1c' });
  store.tasks.push({ id: uid(), category_id: c1, title: 'Tee harjoitukset', is_done: 0, position: 1 });
  store.tasks.push({ id: uid(), category_id: c1, title: 'Lue kappale 3', is_done: 1, position: 2 });
  store.tasks.push({ id: uid(), category_id: c2, title: 'Siivoa huone', is_done: 0, position: 1 });
  store._initialized = true;
  saveData(store);
}

let currentUserId = store.users[0].id;
let currentBoardId = store.boards[0].id;

// --- DOM refs ---
const boardsList = document.getElementById('boardsList');
const newBoardTitle = document.getElementById('newBoardTitle');
const createBoardBtn = document.getElementById('createBoardBtn');
const boardTitle = document.getElementById('boardTitle');
const boardMeta = document.getElementById('boardMeta');
const columnsEl = document.getElementById('columns');
const shareBtn = document.getElementById('shareBtn');
const shareCodeBox = document.getElementById('shareCodeBox');
const shareCodeText = document.getElementById('shareCodeText');
const copyShareBtn = document.getElementById('copyShareBtn');
const joinCodeInput = document.getElementById('joinCodeInput');
const joinCodeBtn = document.getElementById('joinCodeBtn');
const joinMsg = document.getElementById('joinMsg');

function renderBoards() {
  boardsList.innerHTML = '';
  store.boards.forEach(b => {
    const el = document.createElement('div');
    el.className = 'board-item' + (b.id===currentBoardId? ' active':'');
    el.innerHTML = `<div>${escapeHtml(b.title)}</div><div class="small">${b.visibility}</div>`;
    el.onclick = ()=>{ currentBoardId = b.id; render(); };
    boardsList.appendChild(el);
  });
}

function render() {
  renderBoards();
  const board = store.boards.find(b=>b.id===currentBoardId);
  if (!board) { boardTitle.textContent = 'Valitse taulu'; columnsEl.innerHTML=''; boardMeta.textContent=''; shareCodeBox.style.display='none'; return; }
  boardTitle.textContent = board.title;
  boardMeta.textContent = `Omistaja: ${board.owner_id} â€¢ ${board.visibility}`;
  if (board.share_code) {
    shareCodeBox.style.display='flex';
    shareCodeText.textContent = `Koodi: ${board.share_code} (exp: ${board.share_code_expires? new Date(board.share_code_expires).toLocaleString() : 'âˆž'})`;
  } else {
    shareCodeBox.style.display='none';
  }

  // columns
  const categories = store.categories.filter(c=>c.board_id===board.id);
  columnsEl.innerHTML = '';
  categories.forEach(cat => {
    const col = document.createElement('div'); col.className='column';
    col.innerHTML = `<h3><span class="color-dot" style="background:${cat.color||'#ddd'}"></span>${escapeHtml(cat.name)}</h3>`;
    // add category controls
    const inputRow = document.createElement('div'); inputRow.className='input-row';
    const tInput = document.createElement('input'); tInput.placeholder='Uusi tehtÃ¤vÃ¤';
    const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.textContent='LisÃ¤Ã¤';
    addBtn.onclick = ()=>{ if(tInput.value.trim()) addTask(cat.id, tInput.value.trim()); tInput.value=''; };
    inputRow.appendChild(tInput); inputRow.appendChild(addBtn);
    col.appendChild(inputRow);

    const tasks = store.tasks.filter(t=>t.category_id===cat.id).sort((a,b)=>a.position-b.position);
    if (tasks.length===0) {
      const ph = document.createElement('div'); ph.className='placeholder'; ph.textContent='Ei tehtÃ¤viÃ¤'; col.appendChild(ph);
    } else {
      tasks.forEach(t=>{ const tEl = renderTask(t); col.appendChild(tEl); });
    }
    // category footer: delete
    const footer = document.createElement('div'); footer.style.marginTop='8px';
    const delCat = document.createElement('button'); delCat.className='btn ghost'; delCat.textContent='Poista kategoria';
    delCat.onclick = ()=>{ if(confirm('Poistetaanko kategoria ja sen tehtÃ¤vÃ¤t?')) deleteCategory(cat.id); };
    footer.appendChild(delCat);
    col.appendChild(footer);

    columnsEl.appendChild(col);
  });

  // add column UI
  const addCol = document.createElement('div'); addCol.className='column';
  addCol.innerHTML = `<h3>+ LisÃ¤Ã¤ minitaulu</h3>`;
  const inputRow = document.createElement('div'); inputRow.className='input-row';
  const nameInput = document.createElement('input'); nameInput.placeholder='Kategorian nimi';
  const colorInput = document.createElement('input'); colorInput.type='color'; colorInput.value='#6c63ff'; colorInput.title='vÃ¤ri';
  const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.textContent='LisÃ¤Ã¤';
  addBtn.onclick = ()=>{ if(nameInput.value.trim()) addCategory(currentBoardId, nameInput.value.trim(), colorInput.value); nameInput.value=''; };
  inputRow.appendChild(nameInput); inputRow.appendChild(colorInput); inputRow.appendChild(addBtn);
  addCol.appendChild(inputRow);
  columnsEl.appendChild(addCol);
}

function renderTask(t) {
  const div = document.createElement('div'); div.className='task'+(t.is_done? ' done':'');
  div.innerHTML = `<input type='checkbox' ${t.is_done? 'checked':''} /> <div class='title'>${escapeHtml(t.title)}</div> <div style='display:flex;gap:6px'><button class='btn ghost' data-id='edit'>âœŽ</button><button class='btn ghost' data-id='del'>ðŸ—‘</button></div>`;
  const cb = div.querySelector('input[type=checkbox]'); cb.onchange = ()=> toggleDone(t.id, cb.checked);
  div.querySelector("button[data-id='del']").onclick = ()=>{ if(confirm('Poistetaanko tehtÃ¤vÃ¤?')) deleteTask(t.id); };
  div.querySelector("button[data-id='edit']").onclick = ()=>{ const nv = prompt('Muokkaa tehtÃ¤vÃ¤Ã¤', t.title); if(nv) editTask(t.id, nv); };
  return div;
}

// --- data operations ---
function addBoard(title) {
  const b = { id: uid(), owner_id: currentUserId, title, visibility:'private', share_code:null, share_code_expires:null, created_at:new Date().toISOString() };
  store.boards.push(b); saveData(store); currentBoardId=b.id; render();
}
function addCategory(boardId, name, color) {
  const c = { id: uid(), board_id: boardId, name, color }; store.categories.push(c); saveData(store); render();
}
function deleteCategory(catId) {
  store.categories = store.categories.filter(c=>c.id!==catId);
  store.tasks = store.tasks.filter(t=>t.category_id!==catId);
  saveData(store); render();
}
function addTask(categoryId, title) {
  const pos = store.tasks.filter(t=>t.category_id===categoryId).length + 1;
  const t = { id: uid(), category_id: categoryId, title, is_done:0, position: pos };
  store.tasks.push(t); saveData(store); render();
}
function deleteTask(taskId) { store.tasks = store.tasks.filter(t=>t.id!==taskId); saveData(store); render(); }
function editTask(taskId, title) { const t = store.tasks.find(x=>x.id===taskId); if(t){ t.title=title; saveData(store); render(); } }
function toggleDone(taskId, isDone) { const t = store.tasks.find(x=>x.id===taskId); if(t){ t.is_done = isDone?1:0; saveData(store); render(); } }

// share code generation (local) â€” uses same format as server would
function generateLocalShareCode() {
  const tries = 0;
  let code;
  do {
    code = String(Math.floor(Math.random()*1000000)).padStart(6,'0');
  } while (store.boards.some(b=>b.share_code === code));
  return code;
}

async function activateShareLocal(boardId, hours=24) {
  const b = store.boards.find(x=>x.id===boardId);
  if(!b) return null;
  const code = generateLocalShareCode();
  b.visibility='shared'; b.share_code = code; b.share_code_expires = new Date(Date.now() + hours*3600*1000).toISOString();
  saveData(store); render();
  return {share_code:code, expires_in_hours:hours};
}

async function activateShare(boardId) {
  if (appConfig.backendAvailable) {
    // call backend
    const res = await fetch(appConfig.api.activateShare, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body: `board_id=${boardId}` });
    return await res.json();
  } else {
    return await activateShareLocal(boardId);
  }
}

async function joinWithCodeLocal(code) {
  const b = store.boards.find(x=>x.share_code===code);
  if(!b) return { error: 'Code not found' };
  if (b.share_code_expires && new Date(b.share_code_expires) < new Date()) return { error:'Code expired' };
  // add current user as member â€” local model has no board_members table; we'll simulate by pushing to a members array on board
  b._members = b._members || [];
  if (!b._members.includes(currentUserId)) b._members.push(currentUserId);
  saveData(store);
  return { ok:true, board_id: b.id };
}

async function joinWithCode(code) {
  if (appConfig.backendAvailable) {
    const res = await fetch(appConfig.api.joinWithCode, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body: `code=${encodeURIComponent(code)}` });
    return await res.json();
  } else {
    return await joinWithCodeLocal(code);
  }
}

// --- UI wiring ---
createBoardBtn.onclick = ()=>{ if(newBoardTitle.value.trim()) { addBoard(newBoardTitle.value.trim()); newBoardTitle.value=''; } };
shareBtn.onclick = async ()=>{
  const res = await activateShare(currentBoardId);
  if(res && res.share_code) {
    shareCodeBox.style.display='flex'; shareCodeText.textContent = `Koodi: ${res.share_code} (exp: ${res.share_code_expires || res.expires_in_hours + 'h'})`;
  } else {
    alert('Jaaaminen epÃ¤onnistui');
  }
};
copyShareBtn.onclick = ()=>{ const text = shareCodeText.textContent; navigator.clipboard.writeText(text).then(()=> alert('Kopioitu leikepÃ¶ydÃ¤lle')); };
joinCodeBtn.onclick = async ()=>{
  const code = joinCodeInput.value.trim(); if(!code) return; joinMsg.textContent='YhdistetÃ¤Ã¤n...';
  const res = await joinWithCode(code);
  if(res && res.ok) { joinMsg.textContent='Liityit onnistuneesti!'; currentBoardId = res.board_id; render(); } else { joinMsg.textContent = 'Virhe: ' + (res.error || 'ei'); }
};

function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" }[c])); }

render();
</script>
</body>
</html>
=======
<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Boards Pro - Share Update</title>
    <link rel="stylesheet" href="../taulunakyma/taulunakyma.css">
</head>
<body>

    <div class="sidebar">
        <h2>MINI BOARDS</h2>
        <p>Ammattimainen hallinta</p>
        <div id="category-list" class="category-list"></div>
        <button class="add-board-btn" onclick="openModal('board-modal')">+ Luo minitaulu</button>
    </div>

    <div class="main-content">
        <div class="header">
            <h1 id="current-category-title">Ladataan...</h1>
            <button class="btn btn-primary" style="background: var(--accent);" onclick="openShareModal()">ðŸ”— Jaa taulu</button>
        </div>

        <div class="input-group">
            <input type="text" id="todo-input" placeholder="Kirjoita uusi tehtÃ¤vÃ¤...">
            <button class="btn btn-primary" onclick="addTodo()">LisÃ¤Ã¤</button>
        </div>

        <div id="todo-list" class="todo-list"></div>
    </div>

=======
<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Boards Pro - Share Update</title>
    <link rel="stylesheet" href="../taulunakyma/taulunakyma.css">
</head>
<body>

    <div class="sidebar">
        <h2>MINI BOARDS</h2>
        <p>Ammattimainen hallinta</p>
        <div id="category-list" class="category-list"></div>
        <button class="add-board-btn" onclick="openModal('board-modal')">+ Luo minitaulu</button>
    </div>

    <div class="main-content">
        <div class="header">
            <h1 id="current-category-title">Ladataan...</h1>
            <button class="btn btn-primary" style="background: var(--accent);" onclick="openShareModal()">ðŸ”— Jaa taulu</button>
        </div>

        <div class="input-group">
            <input type="text" id="todo-input" placeholder="Kirjoita uusi tehtÃ¤vÃ¤...">
            <button class="btn btn-primary" onclick="addTodo()">LisÃ¤Ã¤</button>
        </div>

        <div id="todo-list" class="todo-list"></div>
    </div>

>>>>>>> Stashed changes
    <div id="board-modal" class="modal">
        <div class="modal-content">
            <h3>Luo uusi minitaulu</h3>
            <p>Anna nimi uudelle taululle:</p>
            <input type="text" id="new-board-name" class="modal-input" placeholder="Esim. Koulu, TyÃ¶...">
            <div style="display: flex; gap: 10px;">
                <button class="btn" style="flex:1; background:#f1f5f9;" onclick="closeModal('board-modal')">Peruuta</button>
                <button class="btn btn-primary" style="flex:1;" onclick="saveNewBoard()">Luo</button>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal">
        <div class="modal-content">
            <h3>Taulu jaettu! ðŸš€</h3>
            <p>TÃ¤ssÃ¤ on jakokoodisi:</p>
            <div id="share-code-display" class="share-code-box">------</div>
            <p style="font-size: 0.8rem;">Koodi on lÃ¤hetetty sÃ¤hkÃ¶postilla yhteistyÃ¶kumppaneille.</p>
            <button class="btn btn-primary" onclick="closeModal('share-modal')" style="width: 100%; margin-top: 10px;">Valmis</button>
        </div>
    </div>
    <script src="../taulunakyma/taulunakyma.js"></script>
</body>
<<<<<<< Updated upstream
</html>
>>>>>>> Stashed changes
=======
</html>
>>>>>>> Stashed changes
